#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(git -C "$SCRIPT_DIR" rev-parse --show-toplevel 2>/dev/null || (cd "$SCRIPT_DIR/.." && pwd))"
QUALITY_SCRIPT="$ROOT_DIR/scripts/run-quality-gates.sh"

if [[ ! -f "$QUALITY_SCRIPT" ]]; then
  echo "[codify-hooks] Unable to locate run-quality-gates.sh at $QUALITY_SCRIPT" >&2
  exit 1
fi

if [[ ! -x "$QUALITY_SCRIPT" ]]; then
  chmod +x "$QUALITY_SCRIPT"
fi

exec "$QUALITY_SCRIPT" "$@"
